#!/bin/bash

# Configuration
API_URL="http://127.0.0.1:8080/api/v1"
DB_NAME="news_portal"
DB_USER="postgres"

echo "ЁЯЪА Starting Data Seed..."

# 1. Create Categories via SQL
echo "ЁЯУБ Creating Categories..."
docker exec news_portal_db psql -U $DB_USER -d $DB_NAME -c "INSERT INTO categories (name, name_bn, slug) VALUES ('Bangladesh', 'ржмрж╛ржВрж▓рж╛ржжрзЗрж╢', 'bangladesh'), ('International', 'ржЖржирзНрждрж░рзНржЬрж╛рждрж┐ржХ', 'international'), ('Sports', 'ржЦрзЗрж▓рж╛', 'sports'), ('Entertainment', 'ржмрж┐ржирзЛржжржи', 'entertainment') ON CONFLICT (slug) DO NOTHING;"

# 2. Get Admin Token
# Assuming the user created an admin with these credentials via 'make create-admin'
echo "ЁЯФС Logging in as admin..."
LOGIN_RESPONSE=$(curl -s -L -X POST $API_URL/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email": "admin@news.com", "password": "password123"}')

TOKEN=$(echo $LOGIN_RESPONSE | grep -oP '(?<="token":")[^"]+')

if [ -z "$TOKEN" ]; then
    echo "тЭМ Error: Could not get auth token."
    echo "Response from server: $LOGIN_RESPONSE"
    echo "Did you run 'make create-admin' with admin@news.com/password123?"
    exit 1
fi

# 3. Get Category IDs
echo "ЁЯФН Fetching Category IDs..."
CATEGORIES=$(curl -s -X GET $API_URL/categories)

CAT_BD=$(echo $CATEGORIES | grep -oP '(?<={"id":")[^"]+(?=","name":"Bangladesh")')
CAT_INT=$(echo $CATEGORIES | grep -oP '(?<={"id":")[^"]+(?=","name":"International")')
CAT_SPT=$(echo $CATEGORIES | grep -oP '(?<={"id":")[^"]+(?=","name":"Sports")')
CAT_ENT=$(echo $CATEGORIES | grep -oP '(?<={"id":")[^"]+(?=","name":"Entertainment")')

# 4. Create News Articles
echo "ЁЯУ░ Creating News Articles..."

IMAGE_URL="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQmBrb0g7kp8aN_DboyzGKw-L5scCLX3PoW-g&s"

# Function to create news
create_news() {
    local cat_id=$1
    local title=$2
    local excerpt=$3
    local content=$4
    local featured=$5

    curl -s -X POST $API_URL/news \
      -H "Authorization: Bearer $TOKEN" \
      -H "Content-Type: application/json" \
      -d "{
        \"category_id\": \"$cat_id\",
        \"title\": \"$title\",
        \"excerpt\": \"$excerpt\",
        \"content\": \"$content\",
        \"thumbnail\": \"$IMAGE_URL\",
        \"is_featured\": $featured
      }" > /dev/null
}

# --- Bangladesh ---
create_news "$CAT_BD" "ржврж╛ржХрж╛ржпрж╝ ржирждрзБржи ржорзЗржЯрзНрж░рзЛ рж░рзЗрж▓ рж░рзБржЯрзЗрж░ ржЙржжрзНржмрзЛржзржи" "рж░рж╛ржЬржзрж╛ржирзАрж░ ржпрж╛ржиржЬржЯ ржирж┐рж░рж╕ржирзЗ ржирждрзБржи ржорж╛ржЗрж▓ржлрж▓ржХред" "<p>ржкрзНрж░ржзрж╛ржиржоржирзНрждрзНрж░рзА ржЖржЬ ржирждрзБржи ржорзЗржЯрзНрж░рзЛ рж░рзЗрж▓ рж░рзБржЯрзЗрж░ ржЙржжрзНржмрзЛржзржи ржХрж░рзЗржЫрзЗржиред ржПрж░ ржлрж▓рзЗ ржЙрждрзНрждрж░рж╛ ржерзЗржХрзЗ ржорждрж┐ржЭрж┐рж▓ ржпрж╛рждрж╛ржпрж╝рж╛ржд ржЖрж░ржУ рж╕рж╣ржЬ рж╣ржмрзЗред</p>" "true"
create_news "$CAT_BD" "ржкржжрзНржорж╛ рж╕рзЗрждрзБрждрзЗ рж░рзЗржХрж░рзНржб ржкрж░рж┐ржорж╛ржг ржЯрзЛрж▓ ржЖржжрж╛ржпрж╝" "ржЧржд рзирзк ржШржгрзНржЯрж╛ржпрж╝ рж╕рзЗрждрзБрж░ ржЯрзЛрж▓ ржЖржжрж╛ржпрж╝рзЗ ржирждрзБржи рж░рзЗржХрж░рзНржбред" "<div style='color: blue;'><p>ржмрзНржпрж╕рзНрждрждржо ржПржЗ рж╕рзЗрждрзБ ржжрж┐рзЯрзЗ ржЧржд ржПржХржжрж┐ржирзЗ рж╣рж╛ржЬрж╛рж░ рж╣рж╛ржЬрж╛рж░ ржпрж╛ржиржмрж╛рж╣ржи ржкрж╛рж░рж╛ржкрж╛рж░ рж╣рзЯрзЗржЫрзЗред</p></div>" "false"
create_news "$CAT_BD" "рж╢рзАрждрзЗрж░ рждрзАржмрзНрж░рждрж╛ ржмрж╛рзЬржЫрзЗ ржЙрждрзНрждрж░рж╛ржЮрзНржЪрж▓рзЗ" "ржкржЮрзНржЪржЧржбрж╝рзЗ рждрж╛ржкржорж╛рждрзНрж░рж╛ ржирзЗржорзЗржЫрзЗ рзо ржбрж┐ржЧрзНрж░рж┐рж░ ржирж┐ржЪрзЗред" "<p>рж╕рж╛рж░рж╛ржжрзЗрж╢рзЗ рж╢рзАрждрзЗрж░ ржкрзНрж░ржХрзЛржк ржмрж╛рзЬржЫрзЗ, ржмрж┐рж╢рзЗрж╖ ржХрж░рзЗ ржЙрждрзНрждрж░рж╛ржЮрзНржЪрж▓рзЗрж░ ржЬрзЗрж▓рж╛ржЧрзБрж▓рзЛрждрзЗ рждрзБрж╖рж╛рж░ржкрж╛рждрзЗрж░ рж╕ржорзНржнрж╛ржмржирж╛ рж░рзЯрзЗржЫрзЗред</p>" "false"

# --- International ---
create_news "$CAT_INT" "ржорж╣рж╛ржХрж╛рж╢рзЗ ржирждрзБржи ржЧрзНрж░рж╣рзЗрж░ ржЦрзЛржБржЬ ржкрзЗрж▓ ржирж╛рж╕рж╛" "ржмрж┐ржЬрзНржЮрж╛ржирзАржжрзЗрж░ ржорждрзЗ ржПржЗ ржЧрзНрж░рж╣рзЗ ржкрзНрж░рж╛ржгрзЗрж░ ржЕрж╕рзНрждрж┐рждрзНржм ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗред" "<p>ржЬрзЗржорж╕ ржУрзЯрзЗржм ржЯрзЗрж▓рж┐рж╕рзНржХрзЛржкрзЗрж░ ржорж╛ржзрзНржпржорзЗ ржПржЗ ржЪрж╛ржЮрзНржЪрж▓рзНржпржХрж░ рждржерзНржп ржкрж╛ржУрзЯрж╛ ржЧрзЗржЫрзЗред</p>" "false"
create_news "$CAT_INT" "ржмрж┐рж╢рзНржм ржЕрж░рзНржержирзАрждрж┐рждрзЗ ржирждрзБржи ржоржирзНржжрж╛рж░ ржкрзВрж░рзНржмрж╛ржнрж╛рж╕" "ржЖржЗржПржоржПржл ржкрзНрж░ржзрж╛ржи рж╕рждрж░рзНржХржмрж╛ржгрзА ржжрж┐рзЯрзЗржЫрзЗржиред" "<p>ржорзВрж▓рзНржпрж╕рзНржлрзАрждрж┐ ржирж┐рзЯржирзНрждрзНрж░ржгрзЗ ржирж╛ ржЖрж╕рж▓рзЗ ржЖржЧрж╛ржорзА ржмржЫрж░ ржХржарж┐ржи рж╣рждрзЗ ржкрж╛рж░рзЗред</p>" "false"

# --- Sports ---
create_news "$CAT_SPT" "ржмрж┐ржкрж┐ржПрж▓рзЗ рж╕рж╛ржХрж┐ржмрзЗрж░ ржЕрж╕рж╛ржзрж╛рж░ржг ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕" "ржПржХрж╛ рж╣рж╛рждрзЗ ржЬрзЯ ржЫрж┐ржирж┐рзЯрзЗ ржирж┐рж▓рзЗржи ржХрзНржпрж╛ржкрзНржЯрзЗржиред" "<p>рзк ржУржнрж╛рж░рзЗ ржорж╛рждрзНрж░ рззрзм рж░рж╛ржи ржжрж┐рзЯрзЗ ржирж┐рж▓рзЗржи рзйржЯрж┐ ржЙржЗржХрзЗржЯред ржмрзНржпрж╛ржЯ рж╣рж╛рждрзЗржУ ржХрж░рзЗржЫрзЗржи ржЭрзЬрзЛ рзкрзи рж░рж╛ржиред</p>" "false"
create_news "$CAT_SPT" "рждрж╛ржорж┐ржорзЗрж░ ржЕржмрж╕рж░ ржирж┐рзЯрзЗ ржЬрж▓рзНржкржирж╛ рждрзБржЩрзНржЧрзЗ" "ржнржХрзНрждржжрзЗрж░ ржЙржжрзНржмрзЗржЧрзЗрж░ ржХрзЛржирзЛ рж╢рзЗрж╖ ржирзЗржЗред" "<p>ржЖржЬ рж╕ржВржмрж╛ржж рж╕ржорзНржорзЗрж▓ржирзЗ рждрж╛ржорж┐ржо рждрж╛рж░ ржнржмрж┐рж╖рзНржпрзО ржирж┐рзЯрзЗ ржХржерж╛ ржмрж▓рждрзЗ ржкрж╛рж░рзЗржиред</p>" "false"
create_news "$CAT_SPT" "ржЖрж░рзНржЬрзЗржирзНржЯрж┐ржирж╛рж░ ржЬрзЯржпрж╛рждрзНрж░рж╛рзЯ ржмрж╛ржзрж╛ ржкрзЬрж▓ ржЙрж░рзБржЧрзБрзЯрзЗ" "ржмрж┐рж╢рзНржм ржЪрзНржпрж╛ржорзНржкрж┐рзЯржиржжрзЗрж░ рж╣рж╛рж░рж╛рж▓ рж╕рзБржпрж╝рж╛рж░рзЗржЬрзЗрж░ ржжрж▓ред" "<p>ржорзЗрж╕рж┐ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзЗржУ ржЧрзЛрж▓ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиржирж┐ ржЖржЬржХрзЗрж░ ржорзНржпрж╛ржЪрзЗред</p>" "false"

# --- Entertainment ---
create_news "$CAT_ENT" "ржЕрж╕рзНржХрж╛рж░рзЗрж░ ржЬржирзНржп рж▓рзЬржЫрзЗ ржмрж╛ржВрж▓рж╛ржжрзЗрж╢рзЗрж░ ржЫржмрж┐" "ржЖржирзНрждрж░рзНржЬрж╛рждрж┐ржХ ржЪрж▓ржЪрзНржЪрж┐рждрзНрж░ ржмрж┐ржнрж╛ржЧрзЗ ржоржирзЛржирзЯржи ржкрзЗрж▓ 'рж╣рж╛ржУрзЯрж╛'ред" "<p>ржЪржЮрзНржЪрж▓ ржЪрзМржзрзБрж░рзА ржЕржнрж┐ржирзАржд ржПржЗ рж╕рж┐ржирзЗржорж╛ржЯрж┐ ржжрзЗрж╢-ржмрж┐ржжрзЗрж╢рзЗ ржмрзНржпрж╛ржкржХ ржкрзНрж░рж╢ржВрж╕рж┐ржд рж╣рзЯрзЗржЫрзЗред</p>" "false"
create_news "$CAT_ENT" "ржмрж▓рж┐ржЙржбрзЗ ржХрж┐ржВ ржЦрж╛ржирзЗрж░ ржирждрзБржи ржзрж╛ржорж╛ржХрж╛" "ржкрж╛ржарж╛ржи ржПрж░ ржкрж░ ржПржмрж╛рж░ ржбржВржХрж┐ ржжрж┐рзЯрзЗ ржмржХрзНрж╕ ржЕржлрж┐рж╕ ржХрж╛ржБржкрж╛рждрзЗ ржЖрж╕ржЫрзЗржи рж╢рж╛рж╣рж░рзБржЦред" "<p>рж░рж╛ржЬржХрзБржорж╛рж░ рж╣рж┐рж░рж╛ржирж┐рж░ ржкрж░рж┐ржЪрж╛рж▓ржирж╛рзЯ рж╢рж╛рж╣рж░рзБржЦрзЗрж░ ржПржЗ рж╕рж┐ржирзЗржорж╛ ржирж┐рзЯрзЗ ржХрзМрждрзБрж╣рж▓рзЗрж░ рж╢рзЗрж╖ ржирзЗржЗред</p>" "false"

echo "тЬЕ Seeding Complete! Enjoy your live News Portal."
