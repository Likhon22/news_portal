#!/bin/bash

# Configuration
API_URL="http://127.0.0.1:8080/api/v1"
DB_NAME="news_portal"
DB_USER="postgres"

echo "ЁЯЪА Starting Data Seed..."



# 2. Get Admin Token
# Assuming the user created an admin with these credentials via 'make create-admin'
echo "ЁЯФС Logging in as admin..."
LOGIN_RESPONSE=$(curl -s -L -X POST $API_URL/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email": "admin@newsportal.com", "password": "password321123"}')

TOKEN=$(echo $LOGIN_RESPONSE | grep -oP '(?<="token":")[^"]+')

if [ -z "$TOKEN" ]; then
    echo "тЭМ Error: Could not get auth token."
    echo "Response from server: $LOGIN_RESPONSE"
    echo "Did you run 'make create-admin' with admin@news.com/password123?"
    exit 1
fi

# 3. Get Category IDs
echo "ЁЯФН Fetching Category IDs..."
# Using a more robust way to get IDs
CATEGORIES=$(curl -s -X GET $API_URL/categories)

# Function to extract ID by Slug (more reliable than name)
get_id() {
    echo $CATEGORIES | grep -oP "(?<=\"id\":\")[^\"]+(?=\",\"name\":[^{]*\"slug\":\"$1\")"
}

CAT_BD=$(get_id "bangladesh")
CAT_INT=$(get_id "international")
CAT_SPT=$(get_id "sports")
CAT_ENT=$(get_id "entertainment")

# 4. Create News Articles
echo "ЁЯУ░ Creating News Articles..."

IMAGE_URL="https://images.unsplash.com/photo-1575936123452-b67c3203c357?fm=jpg&q=60&w=3000&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8aW1hZ2V8ZW58MHx8MHx8fDA%3D"

# Function to create news
create_news() {
    local cat_id=$1
    local title=$2
    local excerpt=$3
    local content=$4
    local featured=$5

    curl -s -X POST $API_URL/SEED_news \
      -H "Authorization: Bearer $TOKEN" \
      -H "Content-Type: application/json" \
      -d "{
        \"category_id\": \"$cat_id\",
        \"title\": \"$title\",
        \"excerpt\": \"$excerpt\",
        \"content\": \"$content\",
        \"thumbnail_url\": \"$IMAGE_URL\",
        \"is_featured\": $featured
      }" > /dev/null
}

# --- Bangladesh (ржмрж╛ржВрж▓рж╛ржжрзЗрж╢) ---
echo "ЁЯЗзЁЯЗй Seeding Bangladesh news..."
create_news "$CAT_BD" "ржкржжрзНржорж╛ рж╕рзЗрждрзБрждрзЗ рж░рзЗржХрж░рзНржб рж░рж╛ржЬрж╕рзНржм ржЖржжрж╛ржпрж╝" "ржЧржд рзирзк ржШржгрзНржЯрж╛ржпрж╝ ржкржжрзНржорж╛ рж╕рзЗрждрзБрждрзЗ рзй ржХрзЛржЯрж┐ ржЯрж╛ржХрж╛рж░ ржмрзЗрж╢рж┐ ржЯрзЛрж▓ ржЖржжрж╛ржпрж╝ рж╣ржпрж╝рзЗржЫрзЗред" "<p>ржкржжрзНржорж╛ рж╕рзЗрждрзБ ржЙржжрзНржмрзЛржзржирзЗрж░ ржкрж░ ржерзЗржХрзЗ ржжрзЗрж╢рзЗрж░ ржжржХрзНрж╖рж┐ржг-ржкрж╢рзНржЪрж┐ржорж╛ржЮрзНржЪрж▓рзЗрж░ ржЕрж░рзНржержирзАрждрж┐рждрзЗ ржЖржорзВрж▓ ржкрж░рж┐ржмрж░рзНрждржи ржПрж╕рзЗржЫрзЗред ржЧржд рзирзк ржШржгрзНржЯрж╛ржпрж╝ рж╕рзЗрждрзБржЯрж┐ ржжрж┐ржпрж╝рзЗ рж░рзЗржХрж░рзНржб рж╕ржВржЦрзНржпржХ ржпрж╛ржиржмрж╛рж╣ржи ржкрж╛рж░рж╛ржкрж╛рж░ рж╣ржпрж╝рзЗржЫрзЗ ржПржмржВ рзй ржХрзЛржЯрж┐ ржЯрж╛ржХрж╛рж░ ржмрзЗрж╢рж┐ ржЯрзЛрж▓ ржЖржжрж╛ржпрж╝ рж╣ржпрж╝рзЗржЫрзЗред</p><p>рж╕рзЗрждрзБ ржХрж░рзНрждрзГржкржХрзНрж╖ ржЬрж╛ржирж┐ржпрж╝рзЗржЫрзЗ, ржорж╛ржУржпрж╝рж╛ ржПржмржВ ржЬрж╛ржЬрж┐рж░рж╛ ржЙржнржпрж╝ ржкрзНрж░рж╛ржирзНрждрзЗржЗ ржпрж╛ржиржмрж╛рж╣ржирзЗрж░ ржЪрж╛ржк ржЫрж┐рж▓ ржЕржирзЗржХ ржмрзЗрж╢рж┐ред</p>" "true"
create_news "$CAT_BD" "ржврж╛ржХрж╛ржпрж╝ ржорзЗржЯрзНрж░рзЛ рж░рзЗрж▓рзЗрж░ ржирждрзБржи рж░рзБржЯ ржЪрж╛рж▓рзБ" "ржорждрж┐ржЭрж┐рж▓ ржерзЗржХрзЗ ржХржорж▓рж╛ржкрзБрж░ ржкрж░рзНржпржирзНржд ржкрж░рзАржХрзНрж╖рж╛ржорзВрж▓ржХржнрж╛ржмрзЗ ржорзЗржЯрзНрж░рзЛ рж░рзЗрж▓ ржЪрж▓рж╛ржЪрж▓ рж╢рзБрж░рзБ рж╣ржпрж╝рзЗржЫрзЗред" "<p>рж░рж╛ржЬржзрж╛ржирзАрж░ ржпрж╛ржиржЬржЯ ржирж┐рж░рж╕ржирзЗ ржорзЗржЯрзНрж░рзЛ рж░рзЗрж▓ ржПржХ ржирждрзБржи ржжрж┐ржЧржирзНржд ржЙржирзНржорзЛржЪржи ржХрж░рзЗржЫрзЗред ржЖржЬ ржерзЗржХрзЗ ржорждрж┐ржЭрж┐рж▓ ржерзЗржХрзЗ ржХржорж▓рж╛ржкрзБрж░ ржкрж░рзНржпржирзНржд ржирждрзБржи рж░рзБржЯрзЗ ржкрж░рзАржХрзНрж╖рж╛ржорзВрж▓ржХржнрж╛ржмрзЗ ржЯрзНрж░рзЗржи ржЪрж▓рж╛ржЪрж▓ рж╢рзБрж░рзБ рж╣ржпрж╝рзЗржЫрзЗред</p><p>ржпрж╛рждрзНрж░рзАрж░рж╛ ржЖрж╢рж╛ ржХрж░ржЫрзЗржи, ржПржЗ рж░рзБржЯржЯрж┐ ржкрзВрж░рзНржгрж╛ржЩрзНржЧржнрж╛ржмрзЗ ржЪрж╛рж▓рзБ рж╣рж▓рзЗ ржпрж╛рждрж╛ржпрж╝рж╛рждрзЗ рж╕ржоржпрж╝ ржЖрж░ржУ ржЕржирзЗржХ ржХржорзЗ ржпрж╛ржмрзЗред</p>" "false"
create_news "$CAT_BD" "рж╕ржмрзБржЬ рж╢рж┐рж▓рзНржкрж╛ржпрж╝ржирзЗ ржмрж┐рж╢рзНржмрзЗрж░ рж╢рзАрж░рзНрж╖рзЗ ржмрж╛ржВрж▓рж╛ржжрзЗрж╢" "ржкрж░рж┐ржмрзЗрж╢ржмрж╛ржирзНржзржм ржХрж╛рж░ржЦрж╛ржирж╛рж░ рждрж╛рж▓рж┐ржХрж╛ржпрж╝ ржмрж╛ржВрж▓рж╛ржжрзЗрж╢рзЗрж░ ржЬржпрж╝ржЬржпрж╝ржХрж╛рж░ред" "<p>ржмрж┐рж╢рзНржмрзЗрж░ рж╢рзАрж░рзНрж╖ рззрзжрзжржЯрж┐ ржкрж░рж┐ржмрзЗрж╢ржмрж╛ржирзНржзржм ржкрзЛрж╢рж╛ржХ ржХрж╛рж░ржЦрж╛ржирж╛рж░ ржоржзрзНржпрзЗ ржЕрж░рзНржзрзЗржХржЗ ржПржЦржи ржмрж╛ржВрж▓рж╛ржжрзЗрж╢рзЗред ржЖржирзНрждрж░рзНржЬрж╛рждрж┐ржХ рж╕рзНржЯрзНржпрж╛ржирзНржбрж╛рж░рзНржб ржорзЗржирзЗ рждрзИрж░рж┐ ржПржЗ ржХрж╛рж░ржЦрж╛ржирж╛ржЧрзБрж▓рзЛ ржмрж╛ржВрж▓рж╛ржжрзЗрж╢рзЗрж░ рж░ржкрзНрждрж╛ржирж┐ ржмрж╛ржгрж┐ржЬрзНржпрзЗ ржирждрзБржи рж╢ржХрзНрждрж┐ ржЬрзЛржЧрж╛ржЪрзНржЫрзЗред</p><p>ржкрж░рж┐ржмрзЗрж╢ржмрж┐ржжрж░рж╛ ржПржЗ ржЙржжрзНржпрзЛржЧржХрзЗ рж╕рж╛ржзрзБржмрж╛ржж ржЬрж╛ржирж┐ржпрж╝рзЗржЫрзЗржиред</p>" "false"

# --- International (ржЖржирзНрждрж░рзНржЬрж╛рждрж┐ржХ) ---
echo "ЁЯМН Seeding International news..."
create_news "$CAT_INT" "ржоржЩрзНржЧрж▓ ржЧрзНрж░рж╣рзЗ ржирждрзБржи ржкрзНрж░рж╛ржгрзЗрж░ рж╕ржирзНржзрж╛ржи" "ржирж╛рж╕рж╛рж░ рж░рзЛржнрж╛рж░ ржоржЩрзНржЧрж▓рзЗрж░ ржмрзБржХрзЗ ржкрзНрж░рж╛ржЪрзАржи ржЬрзАржмржирзЗрж░ ржЪрж┐рж╣рзНржи ржЦрзБржБржЬрзЗ ржкрзЗржпрж╝рзЗржЫрзЗред" "<p>ржЖржорзЗрж░рж┐ржХрж╛ржи ржорж╣рж╛ржХрж╛рж╢ ржЧржмрзЗрж╖ржгрж╛ рж╕ржВрж╕рзНржерж╛ ржирж╛рж╕рж╛ ржЬрж╛ржирж┐ржпрж╝рзЗржЫрзЗ, рждрж╛ржжрзЗрж░ ржкрж╛рж░рж╕рж┐ржнрж┐ржпрж╝рж╛рж░рзЗржирзНрж╕ рж░рзЛржнрж╛рж░ ржоржЩрзНржЧрж▓ ржЧрзНрж░рж╣рзЗрж░ ржПржХржЯрж┐ ржкрзНрж░рж╛ржЪрзАржи рж╣рзНрж░ржжрзЗрж░ рждрж▓ржжрзЗрж╢рзЗ ржЬрзИржм ржЕржгрзБрж░ рж╕ржирзНржзрж╛ржи ржкрзЗржпрж╝рзЗржЫрзЗред</p><p>ржмрж┐ржЬрзНржЮрж╛ржирзАрж░рж╛ ржоржирзЗ ржХрж░ржЫрзЗржи, ржПржЯрж┐ ржХрзЛржЯрж┐ ржХрзЛржЯрж┐ ржмржЫрж░ ржЖржЧрзЗ ржоржЩрзНржЧрж▓рзЗ ржкрзНрж░рж╛ржгрзЗрж░ ржЕрж╕рзНрждрж┐рждрзНржм ржерж╛ржХрж╛рж░ ржПржХржЯрж┐ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА рж╕ржВржХрзЗрждред</p>" "true"
create_news "$CAT_INT" "ржмрж┐рж╢рзНржм ржЬрж▓ржмрж╛ржпрж╝рзБ рж╕ржорзНржорзЗрж▓ржирзЗ ржРрждрж┐рж╣рж╛рж╕рж┐ржХ ржЪрзБржХрзНрждрж┐" "ржХрж╛рж░рзНржмржи ржирж┐ржГрж╕рж░ржг ржХржорж╛рждрзЗ ржПржХржоржд рж╣ржпрж╝рзЗржЫрзЗ ржмрж┐рж╢рзНржмрзЗрж░ рззрзорзжржЯрж┐ ржжрзЗрж╢ред" "<p>ржЬрж▓ржмрж╛ржпрж╝рзБ ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ ржХрзНрж╖рждрж┐ржХрж░ ржкрзНрж░ржнрж╛ржм ржорзЛржХрж╛ржмрж┐рж▓рж╛ржпрж╝ ржПржмрж╛рж░рзЗрж░ рж╕ржорзНржорзЗрж▓ржирзЗ ржПржХ ржРрждрж┐рж╣рж╛рж╕рж┐ржХ ржЪрзБржХрзНрждрж┐ рж╕рзНржмрж╛ржХрзНрж╖рж░рж┐ржд рж╣ржпрж╝рзЗржЫрзЗред ржЙржирзНржиржд ржжрзЗрж╢ржЧрзБрж▓рзЛ рзирзжрзкрзж рж╕рж╛рж▓рзЗрж░ ржоржзрзНржпрзЗ рж╢рждржнрж╛ржЧ ржиржмрж╛ржпрж╝ржиржпрзЛржЧрзНржп ржЬрзНржмрж╛рж▓рж╛ржирж┐ ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржкрзНрж░рждрж┐рж╢рзНрж░рзБрждрж┐ ржжрж┐ржпрж╝рзЗржЫрзЗред</p><p>ржЙржирзНржиржпрж╝ржирж╢рзАрж▓ ржжрзЗрж╢ржЧрзБрж▓рзЛржХрзЗ ржЖрж░рзНржерж┐ржХ рж╕рж╣рж╛ржпрж╝рждрж╛ ржкрзНрж░ржжрж╛ржирзЗрж░ ржЬржирзНржп ржПржХржЯрж┐ ржмрж┐рж╢рзЗрж╖ ржлрж╛ржирзНржб ржЧржаржи ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред</p>" "false"

# --- Sports (ржЦрзЗрж▓рж╛) ---
echo "тЪ╜ Seeding Sports news..."
create_news "$CAT_SPT" "ржмрж┐рж╢рзНржмржХрж╛ржкрзЗ ржмрж╛ржВрж▓рж╛ржжрзЗрж╢рзЗрж░ ржжрзБрж░рзНржжрж╛ржирзНржд ржЬржпрж╝" "рж╢рзЗрж╖ ржУржнрж╛рж░рзЗрж░ рж░рзЛржорж╛ржЮрзНржЪрзЗ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА ржирж┐ржЙржЬрж┐рж▓рзНржпрж╛ржирзНржбржХрзЗ рж╣рж╛рж░рж╛рж▓ ржЯрж╛ржЗржЧрж╛рж░рж░рж╛ред" "<p>ржмрж┐рж╢рзНржмржХрж╛ржкрзЗрж░ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржорзНржпрж╛ржЪрзЗ ржирж┐ржЙржЬрж┐рж▓рзНржпрж╛ржирзНржбржХрзЗ рзй ржЙржЗржХрзЗржЯрзЗ рж╣рж╛рж░рж┐ржпрж╝рзЗ ржЗрждрж┐рж╣рж╛рж╕ ржЧржбрж╝рж▓ ржмрж╛ржВрж▓рж╛ржжрзЗрж╢ред ржжрж▓рзЗрж░ ржЬржпрж╝рзЗ ржЕрж▓рж░рж╛ржЙржирзНржб ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржХрж░рзЗржЫрзЗржи рж╕рж╛ржХрж┐ржм ржЖрж▓ рж╣рж╛рж╕рж╛ржиред</p><p>ржПржЗ ржЬржпрж╝рзЗрж░ ржлрж▓рзЗ рж╕рзЗржорж┐ржлрж╛ржЗржирж╛рж▓рзЗрж░ ржкрже ржЖрж░ржУ ржкрзНрж░рж╢рж╕рзНржд рж╣рж▓рзЛ ржмрж╛ржВрж▓рж╛ржжрзЗрж╢рзЗрж░ ржЬржирзНржпред</p>" "true"
create_news "$CAT_SPT" "рж▓рж┐ржУржирзЗрж▓ ржорзЗрж╕рж┐рж░ ржирждрзБржи рж░рзЗржХрж░рзНржб" "ржЗрждрж┐рж╣рж╛рж╕рзЗрж░ ржкрзНрж░ржержо ржлрзБржЯржмрж▓рж╛рж░ рж╣рж┐рж╕рзЗржмрзЗ рзорзжрзж ржЧрзЛрж▓ ржПржмржВ рзйрзлрзж ржбрзНрж░рж┐ржмрж▓рж┐ржВржпрж╝рзЗрж░ рж░рзЗржХрж░рзНржбред" "<p>ржлрзБржЯржмрж▓ ржЬрж╛ржжрзБржХрж░ рж▓рж┐ржУржирзЗрж▓ ржорзЗрж╕рж┐ ржЖрж░ржУ ржПржХржЯрж┐ ржЕржиржирзНржп ржорж╛ржЗрж▓ржлрж▓ржХ рж╕рзНржкрж░рзНрж╢ ржХрж░рзЗржЫрзЗржиред ржЧрждржХрж╛рж▓рзЗрж░ ржорзНржпрж╛ржЪрзЗ ржЬрзЛржбрж╝рж╛ ржЧрзЛрж▓ ржХрж░рж╛рж░ ржорж╛ржзрзНржпржорзЗ рждрж┐ржирж┐ ржлрзБржЯржмрж▓ ржЗрждрж┐рж╣рж╛рж╕рзЗрж░ рж╕рж░рзНржмрзЛржЪрзНржЪ ржЧрзЛрж▓ржжрж╛рждрж╛рж░ рждрж╛рж▓рж┐ржХрж╛ржпрж╝ ржирж┐ржЬрзЗрж░ ржЕржмрж╕рзНржерж╛ржи ржЖрж░ржУ ржоржЬржмрзБржд ржХрж░рж▓рзЗржиред</p>" "false"

# --- Entertainment (ржмрж┐ржирзЛржжржи) ---
echo "ЁЯОм Seeding Entertainment news..."
create_news "$CAT_ENT" "ржЕрж╕рзНржХрж╛рж░рзЗ ржмрж╛ржВрж▓рж╛ржжрзЗрж╢рзА рж╕рж┐ржирзЗржорж╛рж░ ржЬржпрж╝ржЬржпрж╝ржХрж╛рж░" "рж╕рзЗрж░рж╛ ржЖржирзНрждрж░рзНржЬрж╛рждрж┐ржХ ржЪрж▓ржЪрзНржЪрж┐рждрзНрж░ ржмрж┐ржнрж╛ржЧрзЗ ржоржирзЛржиржпрж╝ржи ржкрзЗрж▓ 'ржЕржЪрзЗржирж╛ ржкрже'ред" "<p>ржмрж╛ржВрж▓рж╛ржжрзЗрж╢рзЗрж░ ржЪрж▓ржЪрзНржЪрж┐рждрзНрж░ ржЗрждрж┐рж╣рж╛рж╕рзЗ ржПржХ ржирждрзБржи ржЕржзрзНржпрж╛ржпрж╝ рж░ржЪрж┐ржд рж╣рж▓рзЛред рждрж░рзБржг ржирж┐рж░рзНржорж╛рждрж╛рж░ 'ржЕржЪрзЗржирж╛ ржкрже' ржЪрж▓ржЪрзНржЪрж┐рждрзНрж░ржЯрж┐ ржмрж┐рж╢рзНржмрзЗрж░ рж╕ржмржЪрзЗржпрж╝рзЗ рж╕ржорзНржорж╛ржиржЬржиржХ ржЕрж╕рзНржХрж╛рж░ ржкрзБрж░рж╕рзНржХрж╛рж░рзЗрж░ ржЬржирзНржп ржоржирзЛржирзАржд рж╣ржпрж╝рзЗржЫрзЗред</p><p>ржЪрж▓ржЪрзНржЪрж┐рждрзНрж░ ржмрж┐рж╢рзЗрж╖ржЬрзНржЮрж░рж╛ ржПржЗ ржЦржмрж░ржХрзЗ ржмрж╛ржВрж▓рж╛ржжрзЗрж╢рзА рж╕рж┐ржирзЗржорж╛рж░ ржЬржирзНржп ржПржХржЯрж┐ ржмрж┐рж░рж╛ржЯ рж╕рж╛ржлрж▓рзНржп рж╣рж┐рж╕рзЗржмрзЗ ржжрзЗржЦржЫрзЗржиред</p>" "true"
create_news "$CAT_ENT" "ржХрзЛржХ рж╕рзНржЯрзБржбрж┐ржУ ржмрж╛ржВрж▓рж╛рж░ ржирждрзБржи рж╕рж┐ржЬржи" "рж▓рзЛржХрж╕ржВржЧрзАржд ржУ ржЖржзрзБржирж┐ржХрждрж╛рж░ ржорзЗрж▓ржмржирзНржзржирзЗ ржЖрж╕ржЫрзЗ ржирждрзБржи ржЪржоржХред" "<p>ржжрзАрж░рзНржШ ржкрзНрж░рждрзАржХрзНрж╖рж╛рж░ ржкрж░ ржХрзЛржХ рж╕рзНржЯрзБржбрж┐ржУ ржмрж╛ржВрж▓рж╛рж░ рждрзГрждрзАржпрж╝ рж╕рж┐ржЬржи рж╢рзБрж░рзБ рж╣рждрзЗ ржпрж╛ржЪрзНржЫрзЗред ржПржмрж╛рж░рзЗрж░ рж╕рж┐ржЬржирзЗ ржерж╛ржХржЫрзЗ ржирждрзБржи ржУ ржкрзБрж░ржирзЛ рж╢рж┐рж▓рзНржкрзАржжрзЗрж░ рж╕ржоржирзНржмржпрж╝рзЗ рждрзИрж░рж┐ ржПржХ ржЧрзБржЪрзНржЫ рж▓рзЛржХржЬ ржУ ржЖржзрзБржирж┐ржХ ржЧрж╛ржиред</p>" "false"

echo ""
echo "тЬЕ Seeding Complete! Enjoy your live News Portal in Bengali."
echo "ЁЯФЧ View categories at: http://localhost:3001/categories"
echo "ЁЯФЧ View news at: http://localhost:3001/news"
